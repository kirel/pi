# llama-swap configuration
# Models to load and serve

healthCheckTimeout: 500
sendLoadingState: true


models:
{% for model in llamaswap_models %}
  {{ model.alias }}:
    cmd: |
      {{ model.cmd }}
    env:
{% if model.env is defined %}
{% for env_var in model.env %}
      - "{{ env_var }}"
{% endfor %}
{% endif %}
{% endfor %}

{% if llamaswap_model_groups is defined %}
groups:
{% for group_name, group_config in llamaswap_model_groups.items() %}
  "{{ group_name }}":
{% if group_config.persistent is defined %}
    persistent: {{ group_config.persistent | lower }}
{% endif %}
{% if group_config.swap is defined %}
    swap: {{ group_config.swap | lower }}
{% endif %}
{% if group_config.exclusive is defined %}
    exclusive: {{ group_config.exclusive | lower }}
{% endif %}
    members:
{% for model in llamaswap_models if group_name == model.group %}
      - "{{ model.alias }}"
{% endfor %}
{% endfor %}
{% endif %}

# Global settings
server:
  # Allow CORS for web interfaces
  cors: true
  # Set timeout
  timeout: 3600

# Preload models on startup
hooks:
  on_startup:
{% if llamaswap_preload is defined and llamaswap_preload %}
    preload:
{% for model_alias in llamaswap_preload %}
{% set found = namespace(base_alias=model_alias) %}
{% for model in llamaswap_models %}
{% if model.variants is defined %}
{% for variant_name, _ in model.variants.items() %}
{% if model.alias ~ '-' ~ variant_name == model_alias %}
{% set found.base_alias = model.alias %}
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}
      - {{ found.base_alias }}
{% endfor %}
{% endif %}
